apply plugin: 'elasticsearch.standalone-test'

dependencies {

  testImplementation "org.reflections:reflections:0.10.2"
  testImplementation "org.javassist:javassist:3.30.2-GA"

  //while it is possible to place a dependency on all x-pack plugins and modules,
  //we will end up with dependency convergence / jar hell issues
  //the set here is a best attempt to include all the relevant modules and x-pack plugins
  testImplementation(testArtifact(project(xpackModule('core'))))
  testImplementation project(path: ':modules:ingest-common')
  testImplementation project(path: ':modules:data-streams')
  testImplementation project(path: ':modules:lang-mustache')
  testImplementation project(path: ':modules:rank-eval')
  testImplementation project(path: ':modules:reindex')
  testImplementation project(path: xpackModule('analytics'))
  testImplementation project(path: xpackModule('async-search'))
  testImplementation project(path: xpackModule('autoscaling'))
  testImplementation project(path: xpackModule('ccr'))
  testImplementation project(path: xpackModule('downsample'))
  testImplementation project(path: xpackModule('eql'))
  testImplementation project(path: xpackModule('esql'))
  testImplementation project(path: xpackModule('esql-core'))
  testImplementation project(path: xpackModule('frozen-indices'))
  testImplementation project(path: xpackModule('graph'))
  testImplementation project(path: xpackModule('ilm'))
  testImplementation project(path: xpackModule('inference'))
  testImplementation project(path: xpackModule('profiling'))
  testImplementation project(path: xpackModule('rollup'))
  testImplementation project(path: xpackModule('slm'))
  testImplementation project(path: xpackModule('sql'))
}
tasks.named("test").configure {
  //test uses reflections to find classes, so we need to disable the security manager
  systemProperty 'tests.security.manager', 'false'
}
tasks.named("forbiddenApisTest") {
  //this test intentionally uses reflection to violate java access control
  it.enabled = false
}
